# PHRアプリ 開発フェーズ計画

本ドキュメントはPHRアプリ開発の各フェーズの作業概要と進捗状況を追跡するためのものです。

## フェーズ概要

| フェーズ | 主な機能 | 予定期間 | ステータス |
|---------|---------|---------|----------|
| フェーズ1 | コア認証＆データ同期 | 1〜2週間 | 完了 ✅ |
| フェーズ2 | 週次ダッシュボード＆小さな勝利バッジ | 1週間 | 完了 ✅ |
| フェーズ3 | パーミッションフロー改善＆ヘルスデータ統合 | 1週間 | 完了 ✅ |
| フェーズ4 | AIチャット（GPT-4o）統合 | 1〜2週間 | 未着手 |
| フェーズ5 | 品質向上＆リリース準備 | 1週間 | 未着手 |

## 詳細な作業内容と進捗状況

### フェーズ1：コア認証＆データ同期（完了）

**目標:** 「自分のデータをクラウドに上げられる」状態を実現

- [x] **ユーザー登録／ログイン機能**
  - [x] Firebase Auth（メール＆パスワード）を画面に組み込む
  - [x] サインアップ後、Firestore にユーザー基本情報ドキュメントを生成
- [x] **歩数・体重データの自動取得**
  - [x] Expo Health（iOS）／Google Fit（Android）連携のラッパーを実装
  - [x] 取得した数値をローカル State に反映
  - [x] Firestore の userMetrics/{userId}/{date} に保存
- [x] **API キー管理の確認**
- [x] **実機で動作確認（クラッシュチェック）**
- [x] **最低限のエラーハンドリング**
  - [x] 認証エラー、パーミッション拒否時の UI フローを用意

### フェーズ2：週次ダッシュボード＆小さな勝利バッジ（完了）

**目標:** 「MVP の顔」であるダッシュボードで 'スモールウィン' の見える化

- [x] **ダッシュボード画面（Weekly View）**
  - [x] React Native Chart Kit で、7日間の歩数・体重推移グラフを実装
- [x] **"+1％ 改善" バッジロジック**
  - [x] 前週比で歩数か体重が「1％以上改善」でバッジ表示
  - [x] バッジ取得履歴を Firestore のコレクションに記録
- [x] **UI/UX チェック**
  - [x] スマホ実機で見栄えを確認
  - [x] セルフレビュー実施

### フェーズ3：パーミッションフロー改善＆ヘルスデータ統合（完了）

**目標:** パーミッション関連の問題解決とヘルスデータ統合の完成

- [x] **パーミッションフローの修正**
  - [x] パーミッション許可後に画面遷移しない問題を解決
  - [x] 権限付与プロセスの安定化
  - [x] 無限ループバグの修正
- [x] **ヘルスデータ統合の改善**
  - [x] iOS HealthKitとの連携強化
  - [x] Android Google Fitとの接続改善
  - [x] ヘルスデータ取得のエラーハンドリング強化
- [x] **ダッシュボードUXの強化**
  - [x] 歩数チャートの表示改善（軸ラベル、データ表示）
  - [x] ツールチップとアニメーションの追加
  - [x] バッジ獲得のフィードバック機能
- [x] **プロフィール/設定画面の追加**
  - [x] パーミッション管理UI
  - [x] テーマ切り替え機能
  - [x] ログアウト機能
- [x] **通知システムの実装**
  - [x] 日々の歩数リマインダー
  - [x] パーミッション処理
- [x] **E2Eテスト & CI構築**
  - [x] Detoxテストフレームワーク設定
  - [x] 認証とダッシュボードのテストファイル作成
  - [x] GitHub Actionsワークフロー追加
  - [x] テストスクリプトの更新

### フェーズ4：AIチャット（GPT-4o）統合（未着手）

**目標:** 「AIコーチ」が最低限会話できる状態を実現

- [ ] **チャットUI**
  - [ ] react-native-gifted-chatなどでシンプルな1:1チャットUIを実装
- [ ] **APIブリッジ**
  - [ ] OpenAI SDK または fetch で Cloud Function 経由/直接 GPT-4o 呼び出し
  - [ ] System Promptに「動機づけ面接ガイド」などをセット
- [ ] **利用制限ロジック**
  - [ ] 1日あたり5往復まで／1週間20往復までなど、無料枠を考慮した制御
- [ ] **エラー時フォールバック**
  - [ ] API過負荷やエラー時の適切なUXの提供

### フェーズ5：品質向上＆リリース準備（未着手）

**目標:** 社内/クローズドユーザーへのテスト提供を可能にする

- [ ] **UI/UX微調整**
  - [ ] アニメーションやマージン調整
  - [ ] ボタンのタップ領域拡大
  - [ ] 全体的な洗練
- [ ] **E2Eテスト拡充**
  - [ ] 重要フロー（登録→同期→バッジ取得→通知）の自動テスト
- [ ] **CI/CDパイプライン強化**
  - [ ] GitHub Actionsでプッシュ時にビルド＆Eslint／TypeScriptチェック
- [ ] **Betaリリース**
  - [ ] TestFlight／Android内部テストトラックでユーザー招待
  - [ ] 最初の数名に使ってもらい、フィードバック収集

## 各フェーズの成果物

### フェーズ1
- 機能するユーザー認証システム
- ヘルスデータ取得の基本機能
- データ同期の初期実装

### フェーズ2
- 週次データ可視化ダッシュボード
- バッジシステムとモチベーション機能
- 改善された全体的なUI

### フェーズ3
- 安定したパーミッションフロー
- 改善されたヘルスデータ統合
- 強化されたダッシュボードUX
- プロフィール/設定機能
- 通知システム
- 初期テスト自動化

### フェーズ4（予定）
- AIチャットインターフェース
- GPT-4o統合
- ユーザー会話制限機能
- エラー処理フォールバック

### フェーズ5（予定）
- 洗練されたUI/UX
- 包括的な自動テスト
- CI/CDパイプライン
- ベータ版リリース準備
